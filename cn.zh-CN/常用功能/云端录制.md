# 云端录制

阿里云RTC为您提供录制服务，将正在进行实时音视频通话时频道的画面同步到云端进行云端混流，并将混流后的频道内容进行录制，同时您也可以根据业务场景自由选择录制的内容。通过本文，您可以快速了解录制服务的基本概念和功能说明。

**说明：** 云端录制功能暂时免收相关费用，后续收费信息请您关注官网的通知。

## 前提条件

在使用录制服务前，您需要完成以下操作：

-   您已经完成注册阿里云账号，并完成实名认证。具体操作，请参见[t12832.md\#]()
-   您已经开通音视频通信服务。具体操作，请参见[开通服务](https://help.aliyun.com/document_detail/111590.html#task-1797646)
-   您需要在阿里云音视频通信RTC控制台创建应用。具体操作，请参见[创建应用](https://help.aliyun.com/document_detail/124297.html?spm=a2c4g.11186623.6.567.2096fcb5hSozhp)
-   您需要开通阿里云OSS服务存储录制文件。具体操作，请参见[开通服务](https://www.aliyun.com/product/oss)。
-   您需要开通阿里云MNS服务接收录制回调消息。具体操作，请参见[开通服务](https://www.aliyun.com/product/mns)。

## 流程图

![1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5207796061/p187346.png)

## 录制存储到OSS

阿里云RTC服务支持将接收到的源视频流进行录制，支持M3U8（同时会有.ts分片文件） 格式，也支持周期录制时长的配置，视频文件会保存至您指定的OSS存储位置。录制任务结束时，自动生成本次的录制索引文件（M3U8文件）。还支持按您指定的录制开始时间和录制结束时间生成自定义录制索引文件。

**说明：**

-   为了便于您对录制内容进行回看，录制的视频存储在OSS bucket中。本文以录制存储至OSS为例进行说明。
-   如果将录制的视频存储至OSS中，您需要授权阿里云RTC可将视频内容写入OSS。授权后才能将视频存储至指定的OSS bucket中。
-   为了避免录制时，因网络抖动或临时断流而导致录制文件被异常截断，系统会延迟断流180s，即如果断流之后在180s内重新推流，系统会默认是同一路录制流，超过180s则认为是两路录制流。

1.  如何配置OSS，请参见[配置OSS](/cn.zh-CN/用户指南/录制管理/录制存储至OSS/配置OSS.md)。

2.  配置RTC写入OSS权限

    阿里云RTC录制文件保存到用户OSS，需要授权RTC访问用户OSS资源，RTC通过服务关联角色AliyunServiceRoleForRTC访问相应用户资源。

    1.  您需要拥有指定的权限，才能自动创建或删除AliyunServiceRoleForRTC。因此在RAM用户无法自动创建AliyunServiceRoleForRTC时，您需为其添加以下权限策略。

        ```
        {
            "Statement": [
                {
                    "Action": [
                        "ram:CreateServiceLinkedRole"
                    ],
                    "Resource": "acs:ram:*:主账号ID:role/*",
                    "Effect": "Allow",
                    "Condition": {
                        "StringEquals": {
                            "ram:ServiceName": [
                                "rtc.aliyuncs.com"
                            ]
                        }
                    }
                }
            ],
            "Version": "1"
        }
        ```

        **说明：** 请将主账号ID替换为您实际的阿里云主账号ID。

    2.  登录RAM访问控制，选择**权限策略管理** \> **新建自定义权限策略**，为RAM用户创建新的权限策略。

        ![1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/8780986061/p187209.png)


## 主要接口及功能

|接口|描述|
|[AddRecordTemplate](/cn.zh-CN/API参考/云端录制/AddRecordTemplate.md)|添加录制配置模板|
|[DeleteRecordTemplate](/cn.zh-CN/API参考/云端录制/DeleteRecordTemplate.md)|删除录制配置模板|
|[UpdateRecordTemplate](/cn.zh-CN/API参考/云端录制/UpdateRecordTemplate.md)|更新录制配置模板|
|[DescribeRecordTemplates](/cn.zh-CN/API参考/云端录制/DescribeRecordTemplates.md)|查询录制模板配置列表|
|[DescribeRecordFiles](/cn.zh-CN/API参考/云端录制/DescribeRecordFiles.md)|查询录制的文件列表|
|[StartRecordTask](/cn.zh-CN/API参考/云端录制/StartRecordTask.md)|开始录制视频任务|
|[StopRecordTask](/cn.zh-CN/API参考/云端录制/StopRecordTask.md)|停止视频录制任务|
|[UpdateRecordTask](/cn.zh-CN/API参考/云端录制/UpdateRecordTask.md)|运行中任务参数更新|

